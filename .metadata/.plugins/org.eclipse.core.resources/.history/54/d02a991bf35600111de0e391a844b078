package com.applicake.beanstalkclient.tasks;

import com.applicake.beanstalkclient.Repository;
import com.applicake.beanstalkclient.Strings;
import com.applicake.beanstalkclient.utils.HttpRetriever;
import com.applicake.beanstalkclient.utils.XmlParser;
import com.applicake.beanstalkclient.utils.HttpRetriever.HttpConnectionErrorException;
import com.applicake.beanstalkclient.utils.HttpRetriever.UnsuccessfulServerResponseException;
import com.applicake.beanstalkclient.utils.XmlParser.XMLParserException;

import android.content.SharedPreferences;
import android.os.AsyncTask;

public class DownloadRepositoryDetails extends AsyncTask<Void, Void, Repository> {
  
  private ResponseHandler<Repository> responseHandler;
  private int repoId;
  private SharedPreferences prefs;
  
  public DownloadRepositoryDetails(int repoId, SharedPreferences prefs, ResponseHandler<Repository> responseHandler) {
    this.responseHandler = responseHandler;
    this.repoId = repoId;
  }
  
  @Override
  protected Repository doInBackground(Integer... params) {
    try {
      String repositoryXml = HttpRetriever.getRepositoryXML(prefs, repository.getId());
      Repository repository = XmlParser.parseRepository(repositoryXml);
      return repository;

    } catch (UnsuccessfulServerResponseException e) {
      errorMessage = e.getMessage();
      return false;
    } catch (HttpConnectionErrorException e) {
      failMessage = Strings.networkConnectionErrorMessage;
    } catch (XMLParserException e) {
      failMessage = Strings.internalErrorMessage;
    }
    failed = true;
    return false;

  }

}
